(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[157],{2674:(e,t,s)=>{Promise.resolve().then(s.bind(s,8171))},8171:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var a=s(5155),r=s(2115);function l(){let[e,t]=(0,r.useState)(""),[s,l]=(0,r.useState)("Ready to start camera"),[n,i]=(0,r.useState)(!1),[c,o]=(0,r.useState)(!1),[d,m]=(0,r.useState)("Offline"),[x,u]=(0,r.useState)(null),[b,h]=(0,r.useState)({facingMode:"environment",quality:"HD"}),g=(0,r.useRef)(null),p=(0,r.useRef)(null),f=(0,r.useRef)(null),j=(0,r.useRef)(null);(0,r.useEffect)(()=>{o(!0),t("phone_"+Math.random().toString(36).substr(2,9))},[]),(0,r.useEffect)(()=>{e&&c&&(async()=>{try{await fetch("/api/signaling",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"register",deviceId:e,data:{deviceType:"phone"}})}),m("Connected to server"),console.log("\uD83D\uDCF1 Phone registered:",e)}catch(e){console.error("Registration error:",e),m("Connection failed")}})()},[e,c]);let v=async()=>{try{l("Starting camera...");let e={video:(()=>{let e={facingMode:b.facingMode,aspectRatio:{ideal:16/9},frameRate:{ideal:30,min:15,max:30}};return"HD"===b.quality?{...e,width:{ideal:1280,min:640,max:1920},height:{ideal:720,min:480,max:1080}}:"SD"===b.quality?{...e,width:{ideal:854,min:480,max:1280},height:{ideal:480,min:360,max:720}}:{...e,width:{ideal:640,min:320,max:854},height:{ideal:360,min:240,max:480}}})(),audio:!1};console.log("\uD83D\uDCF9 Requesting camera with constraints:",e);let t=await navigator.mediaDevices.getUserMedia(e),s=t.getVideoTracks()[0];if(s){let e=s.getSettings();console.log("\uD83D\uDCF9 Camera settings:",e)}p.current=t,g.current&&(g.current.srcObject=t,g.current.onloadedmetadata=()=>{var e;console.log("\uD83D\uDCFA Video metadata loaded"),null==(e=g.current)||e.play().catch(e=>{console.error("❌ Video play failed:",e)})}),i(!0),l("Camera active - Ready for connections"),y()}catch(e){console.error("❌ Camera error:",e),"NotAllowedError"===e.name?l("❌ Camera access denied. Please allow camera permissions."):"NotFoundError"===e.name?l("❌ No camera found on this device."):l("❌ Camera error: ".concat(e.message))}},N=()=>{p.current&&(p.current.getTracks().forEach(e=>e.stop()),p.current=null),g.current&&(g.current.srcObject=null),f.current&&(f.current.close(),f.current=null),j.current&&clearInterval(j.current),i(!1),l("Camera stopped"),u(null)},y=()=>{let t=async()=>{try{let t=await fetch("/api/signaling?type=offer&deviceId=".concat(e,"&sessionId=").concat(e,"_browser")),s=await t.json();s.success&&s.offer&&await w(s.offer)}catch(e){console.error("Error polling for offers:",e)}};t(),j.current=setInterval(t,1e3)},w=async t=>{try{console.log("\uD83D\uDCE5 Received offer from browser");let s=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});f.current=s,p.current&&p.current.getTracks().forEach(e=>{s.addTrack(e,p.current)}),s.onicecandidate=async t=>{if(t.candidate)try{await fetch("/api/signaling",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"ice-candidate",deviceId:e,targetId:"browser",data:{sessionId:"".concat(e,"_browser"),candidate:t.candidate}})})}catch(e){console.error("Error sending ICE candidate:",e)}},await s.setRemoteDescription(t);let a=await s.createAnswer();await s.setLocalDescription(a),await fetch("/api/signaling",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"answer",deviceId:e,targetId:"browser",data:{sessionId:"".concat(e,"_browser"),answer:a}})}),u("browser"),l("\uD83D\uDD34 Live streaming to browser"),console.log("\uD83D\uDCE4 Answer sent to browser")}catch(e){console.error("Error handling offer:",e),l("❌ Connection failed")}},C=()=>{h(e=>({...e,facingMode:"environment"===e.facingMode?"user":"environment"})),n&&(N(),setTimeout(()=>v(),100))};return c?(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-950 text-white",children:[(0,a.jsx)("header",{className:"bg-slate-950/80 backdrop-blur-xl border-b border-slate-800/50 sticky top-0 z-50",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:"\uD83D\uDCF1 Phone Camera"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 bg-slate-800/50 px-3 py-2 rounded-full",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("Connected to server"===d?"bg-green-400 animate-pulse":"bg-red-400")}),(0,a.jsx)("span",{className:"text-sm text-slate-300",children:d})]})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-500/20 to-purple-500/20 border border-blue-400/30 px-4 py-2 rounded-xl",children:[(0,a.jsx)("div",{className:"text-xs text-slate-300 mb-1",children:"Device ID"}),(0,a.jsx)("div",{className:"font-mono text-lg font-bold text-blue-400",children:e.slice(-8)})]})]})})}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[(0,a.jsx)("div",{className:"mb-6 bg-slate-800/40 backdrop-blur-sm border border-slate-700/50 rounded-2xl p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full ".concat(n?x?"bg-red-500 animate-pulse":"bg-yellow-500 animate-pulse":"bg-gray-500")}),(0,a.jsx)("span",{className:"text-lg font-semibold text-white",children:s})]}),x&&(0,a.jsx)("div",{className:"bg-red-500/20 border border-red-500/30 px-4 py-2 rounded-full",children:(0,a.jsx)("span",{className:"text-red-400 text-sm font-semibold uppercase tracking-wide",children:"\uD83D\uDD34 LIVE"})})]})}),(0,a.jsx)("div",{className:"bg-slate-800/40 backdrop-blur-sm border border-slate-700/50 rounded-2xl p-6 mb-6",children:(0,a.jsxs)("div",{className:"relative bg-black rounded-xl overflow-hidden shadow-2xl aspect-[3/4] md:aspect-video",children:[(0,a.jsx)("video",{ref:g,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),!n&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/80",children:(0,a.jsxs)("div",{className:"text-center p-8",children:[(0,a.jsx)("div",{className:"text-8xl mb-6 opacity-30",children:"\uD83D\uDCF7"}),(0,a.jsx)("div",{className:"text-2xl mb-4 text-slate-200 font-light",children:"Camera Inactive"}),(0,a.jsx)("div",{className:"text-lg text-slate-400 mb-6",children:"Start your camera to begin streaming"})]})}),n&&(0,a.jsxs)("div",{className:"absolute top-4 right-4 flex flex-col gap-2",children:[(0,a.jsx)("button",{onClick:C,className:"bg-black/50 hover:bg-black/70 backdrop-blur-sm text-white p-3 rounded-full transition-all duration-200",title:"Switch Camera",children:"\uD83D\uDD04"}),(0,a.jsx)("div",{className:"bg-black/50 backdrop-blur-sm px-3 py-1 rounded-full",children:(0,a.jsx)("span",{className:"text-white text-sm font-medium",children:"environment"===b.facingMode?"\uD83D\uDCF9 Rear":"\uD83E\uDD33 Front"})})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{className:"bg-slate-800/40 backdrop-blur-sm border border-slate-700/50 rounded-2xl p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:"\uD83D\uDCF7 Camera Controls"}),(0,a.jsxs)("div",{className:"space-y-4",children:[n?(0,a.jsx)("button",{onClick:N,className:"w-full bg-red-600/20 hover:bg-red-600/30 border border-red-500/50 text-red-400 py-4 px-6 rounded-xl text-lg font-semibold transition-all duration-200 flex items-center justify-center gap-3",children:"⏹️ Stop Camera"}):(0,a.jsx)("button",{onClick:v,className:"w-full bg-green-600/20 hover:bg-green-600/30 border border-green-500/50 text-green-400 py-4 px-6 rounded-xl text-lg font-semibold transition-all duration-200 flex items-center justify-center gap-3",children:"▶️ Start Camera"}),(0,a.jsx)("button",{onClick:C,disabled:!n,className:"w-full py-3 px-6 rounded-xl font-medium transition-all duration-200 flex items-center justify-center gap-3 ".concat(n?"bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/50 text-blue-400":"bg-slate-600/20 border border-slate-500/30 text-slate-500 cursor-not-allowed"),children:"\uD83D\uDD04 Switch Camera"})]})]}),(0,a.jsxs)("div",{className:"bg-slate-800/40 backdrop-blur-sm border border-slate-700/50 rounded-2xl p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:"⚙️ Quality Settings"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-slate-300 mb-3",children:"Video Quality"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:["HD","SD","LOW"].map(e=>(0,a.jsx)("button",{onClick:()=>{h(t=>({...t,quality:e})),n&&(N(),setTimeout(()=>v(),100))},className:"py-2 px-3 rounded-lg text-sm font-medium transition-all duration-200 ".concat(b.quality===e?"bg-blue-600/30 border border-blue-500/50 text-blue-400":"bg-slate-700/30 border border-slate-600/30 text-slate-400 hover:bg-slate-700/50"),children:e},e))})]}),(0,a.jsxs)("div",{className:"bg-slate-700/20 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"text-sm text-slate-300 mb-2",children:[(0,a.jsx)("strong",{children:"Current:"})," ",b.quality," Quality"]}),(0,a.jsxs)("div",{className:"text-xs text-slate-400",children:["Camera:"," ","environment"===b.facingMode?"Rear":"Front"]})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-blue-900/20 to-purple-900/20 border border-blue-700/30 rounded-2xl p-6",children:[(0,a.jsx)("h4",{className:"text-lg font-bold text-blue-300 mb-4 flex items-center gap-2",children:"\uD83D\uDCCB Connection Instructions"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"font-semibold text-white mb-3",children:"\uD83D\uDCF1 On This Phone:"}),(0,a.jsxs)("ol",{className:"space-y-2 text-sm text-slate-300",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"bg-blue-500/20 text-blue-400 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold",children:"1"}),(0,a.jsx)("span",{children:'Click "Start Camera" to begin'})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"bg-blue-500/20 text-blue-400 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold",children:"2"}),(0,a.jsx)("span",{children:"Allow camera permissions when prompted"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"bg-blue-500/20 text-blue-400 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold",children:"3"}),(0,a.jsxs)("span",{children:["Note your Device ID: ",(0,a.jsx)("strong",{className:"text-blue-400",children:e.slice(-8)})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"font-semibold text-white mb-3",children:"\uD83D\uDCBB On Browser:"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-slate-300",children:[(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-blue-400",children:"\uD83C\uDF10"}),(0,a.jsx)("span",{children:"Open the browser view on your computer"})]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-blue-400",children:"�"}),(0,a.jsxs)("span",{children:["Look for device ID ",(0,a.jsx)("strong",{className:"text-blue-400",children:e.slice(-8)})]})]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-blue-400",children:"�"}),(0,a.jsx)("span",{children:'Click "Connect" to start streaming'})]})]})]})]})]})]})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-950 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-white text-2xl font-light",children:"Loading Camera Interface..."})})}}},e=>{e.O(0,[441,964,358],()=>e(e.s=2674)),_N_E=e.O()}]);