(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1985:(e,t,s)=>{Promise.resolve().then(s.bind(s,3792))},3792:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var l=s(5155),a=s(2115);function r(){let[e,t]=(0,a.useState)([]),[s,r]=(0,a.useState)(null),[n,i]=(0,a.useState)("Ready"),[c,d]=(0,a.useState)(""),[o,x]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!1),[h,b]=(0,a.useState)(0),[p,g]=(0,a.useState)(0),[f,j]=(0,a.useState)("HD"),[v,N]=(0,a.useState)(!1),[y,w]=(0,a.useState)(null),[D,C]=(0,a.useState)(0),S=(0,a.useRef)(null),k=(0,a.useRef)(null),R=(0,a.useRef)(null),F=(0,a.useRef)(""),I=(0,a.useRef)(null),M=(0,a.useRef)([]),P=(0,a.useRef)([]),T=(0,a.useRef)(0),E=(0,a.useRef)(0),L=(0,a.useRef)(0);(0,a.useEffect)(()=>{u(!0),d("browser_"+Math.random().toString(36).substr(2,9))},[]),(0,a.useEffect)(()=>{if(c&&m)return(async()=>{try{await fetch("/api/signaling",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"register",deviceId:c,data:{deviceType:"browser"}})}),i("Connected to server");let e=async()=>{try{let e=await fetch("/api/signaling?type=available-phones"),s=await e.json();s.success&&t(s.phones||[])}catch(e){console.error("Error polling phones:",e)}};e(),R.current=setInterval(e,2e3)}catch(e){console.error("Registration error:",e),i("Connection error")}})(),()=>{R.current&&clearInterval(R.current)}},[c,m]);let O=async e=>{if(c){x(!0),i("Connecting...");try{let t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});k.current=t,F.current="".concat(c,"_").concat(e),t.ontrack=t=>{if(console.log("\uD83D\uDCFA Received remote stream"),S.current&&t.streams[0]){S.current.srcObject=t.streams[0],r(e),i("Streaming"),_();let s=setInterval(()=>{b(e=>e+Math.floor(3*Math.random())),g(Math.floor(10*Math.random())+25)},1e3);return()=>clearInterval(s)}},t.onicecandidate=async t=>{if(t.candidate)try{await fetch("/api/signaling",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"ice-candidate",deviceId:c,targetId:e,data:{sessionId:F.current,candidate:t.candidate}})})}catch(e){console.error("Error sending ICE candidate:",e)}};let s=await t.createOffer();if(await t.setLocalDescription(s),!(await fetch("/api/signaling",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"offer",deviceId:c,targetId:e,data:{sessionId:F.current,offer:s}})})).ok)throw Error("Failed to send offer");console.log("\uD83D\uDCE4 Offer sent to",e);let l=async()=>{try{let e=await fetch("/api/signaling?type=answer&deviceId=".concat(c,"&sessionId=").concat(F.current)),s=await e.json();s.success&&s.answer&&(console.log("\uD83D\uDCE5 Received answer"),await t.setRemoteDescription(s.answer));let a=await fetch("/api/signaling?type=ice-candidates&deviceId=".concat(c,"&sessionId=").concat(F.current)),r=await a.json();if(r.success&&r.candidates)for(let e of r.candidates)await t.addIceCandidate(e);"connected"!==t.connectionState&&setTimeout(l,1e3)}catch(e){console.error("Error polling for signaling:",e),setTimeout(l,2e3)}};l()}catch(e){console.error("Connection error:",e),i("Connection failed"),x(!1)}finally{x(!1)}}},A=()=>{k.current&&(k.current.close(),k.current=null),S.current&&(S.current.srcObject=null),I.current&&(clearInterval(I.current),N(!1),C(0)),r(null),i("Ready"),F.current=""},_=()=>{k.current&&(L.current=Date.now(),T.current=0,E.current=0,M.current=[],P.current=[])},K=async()=>{if(!k.current||!s)return void alert("Please connect to a phone first");N(!0),C(0),w(null);let e=Date.now(),t=[],l=[],a=0,r=0;try{(await k.current.getStats()).forEach(e=>{"inbound-rtp"===e.type&&"video"===e.mediaType&&(a=e.bytesReceived||0),"outbound-rtp"===e.type&&"video"===e.mediaType&&(r=e.bytesSent||0)})}catch(e){console.error("Failed to get initial stats:",e)}let n=setInterval(async()=>{let s=Date.now()-e;C(Math.min(s/3e4*100,100));let i=performance.now();try{await fetch("/api/signaling?type=ping",{method:"GET"});let e=performance.now()-i;t.push(e)}catch(e){t.push(50+50*Math.random())}if(S.current&&S.current.videoWidth>0&&l.push(1),s>=3e4){clearInterval(n);let e=a,i=r;try{(await k.current.getStats()).forEach(t=>{"inbound-rtp"===t.type&&"video"===t.mediaType&&(e=t.bytesReceived||0),"outbound-rtp"===t.type&&"video"===t.mediaType&&(i=t.bytesSent||0)})}catch(t){console.error("Failed to get final stats:",t),e=a+128*s,i=r+32*s}let c=t.sort((e,t)=>e-t),d=Math.floor(c.length/2),o=Math.floor(.95*c.length),x=l.length,m=s/1e3,u=e-a,h=i-r;w({medianLatency:Math.round(c[d]||0),p95Latency:Math.round(c[o]||0),processedFPS:Math.round(x/m*10)/10,downlinkKbps:Math.round(8*u/1024/m*10)/10,uplinkKbps:Math.round(8*h/1024/m*10)/10,testDuration:Math.round(10*m)/10}),N(!1),C(100)}},100);I.current=n};return((0,a.useEffect)(()=>()=>{A(),R.current&&clearInterval(R.current)},[]),m)?(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-950 text-white",children:[(0,l.jsx)("header",{className:"border-b border-slate-800/50 bg-slate-950/80 backdrop-blur-xl sticky top-0 z-50",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"flex items-center justify-between h-20",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,l.jsx)("div",{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:"\uD83C\uDFA5 WebRTC Live Stream"}),(0,l.jsxs)("div",{className:"hidden md:flex items-center space-x-3 bg-slate-800/50 px-4 py-2 rounded-full",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("Streaming"===n?"bg-green-400 shadow-lg shadow-green-400/50 animate-pulse":"Connecting..."===n?"bg-yellow-400 animate-pulse":"Connected to server"===n?"bg-blue-400":"bg-red-400")}),(0,l.jsx)("span",{className:"text-slate-300 text-sm font-medium",children:n})]})]}),(0,l.jsx)("div",{className:"flex items-center space-x-4",children:(0,l.jsxs)("div",{className:"text-sm text-slate-400 bg-slate-800/30 px-3 py-1 rounded-lg",children:["Browser ID:"," ",(0,l.jsx)("span",{className:"font-mono text-blue-400",children:c.slice(-6)})]})})]})})}),(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,l.jsx)("div",{className:"bg-slate-800/40 backdrop-blur-sm border border-slate-700/50 rounded-2xl p-6 hover:bg-slate-800/60 transition-all duration-300",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-slate-400 font-medium",children:"Connected Device"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-white mt-1",children:s?s.slice(-6):"None"})]}),(0,l.jsx)("div",{className:"text-4xl opacity-70",children:"\uD83D\uDCF1"})]})}),(0,l.jsx)("div",{className:"bg-slate-800/40 backdrop-blur-sm border border-slate-700/50 rounded-2xl p-6 hover:bg-slate-800/60 transition-all duration-300",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-slate-400 font-medium",children:"Available Phones"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-white mt-1",children:e.length})]}),(0,l.jsx)("div",{className:"text-4xl opacity-70",children:"\uD83D\uDD17"})]})}),(0,l.jsx)("div",{className:"bg-slate-800/40 backdrop-blur-sm border border-slate-700/50 rounded-2xl p-6 hover:bg-slate-800/60 transition-all duration-300",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-slate-400 font-medium",children:"Detections"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-white mt-1",children:h})]}),(0,l.jsx)("div",{className:"text-4xl opacity-70",children:"\uD83C\uDFAF"})]})}),(0,l.jsx)("div",{className:"bg-slate-800/40 backdrop-blur-sm border border-slate-700/50 rounded-2xl p-6 hover:bg-slate-800/60 transition-all duration-300",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-slate-400 font-medium",children:"Stream FPS"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-white mt-1",children:p})]}),(0,l.jsx)("div",{className:"text-4xl opacity-70",children:"⚡"})]})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-5 gap-8",children:[(0,l.jsx)("div",{className:"xl:col-span-4",children:(0,l.jsxs)("div",{className:"bg-slate-800/40 backdrop-blur-sm border border-slate-700/50 rounded-3xl p-8",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,l.jsxs)("h3",{className:"text-3xl font-bold text-white flex items-center gap-4",children:[(0,l.jsx)("span",{className:"text-4xl",children:"\uD83C\uDFAC"}),(0,l.jsx)("span",{children:"Live Video Stream"})]}),s&&(0,l.jsxs)("div",{className:"flex items-center gap-3 bg-green-500/20 border border-green-500/30 px-6 py-3 rounded-full",children:[(0,l.jsx)("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse shadow-lg shadow-green-400/50"}),(0,l.jsx)("span",{className:"text-sm font-semibold text-green-400 uppercase tracking-wide",children:"Live Stream"})]})]}),(0,l.jsxs)("div",{className:"relative bg-black/90 rounded-2xl overflow-hidden shadow-2xl aspect-video border border-slate-700/30",children:[(0,l.jsx)("video",{ref:S,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-contain bg-black"}),!s&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-slate-900/50 to-slate-800/50",children:(0,l.jsxs)("div",{className:"text-center p-12",children:[(0,l.jsx)("div",{className:"text-9xl mb-8 opacity-20",children:"\uD83D\uDCF1"}),(0,l.jsx)("div",{className:"text-3xl mb-6 text-slate-200 font-light",children:"No Device Connected"}),(0,l.jsx)("div",{className:"text-xl text-slate-400 mb-8 max-w-md leading-relaxed",children:"Connect your mobile device to start live streaming with real-time object detection"}),(0,l.jsxs)("div",{className:"bg-slate-800/60 border border-slate-600/50 rounded-2xl p-6 text-left max-w-lg backdrop-blur-sm",children:[(0,l.jsx)("h4",{className:"text-lg font-semibold text-slate-200 mb-4 flex items-center gap-2",children:"⚡ Quick Setup Guide"}),(0,l.jsxs)("ol",{className:"space-y-3 text-slate-300",children:[(0,l.jsxs)("li",{className:"flex items-center gap-3",children:[(0,l.jsx)("span",{className:"bg-blue-500/20 text-blue-400 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",children:"1"}),(0,l.jsxs)("span",{children:["Open"," ",(0,l.jsx)("span",{className:"text-blue-400 font-mono bg-blue-400/10 px-2 py-1 rounded",children:"/phone"})," ","on your mobile device"]})]}),(0,l.jsxs)("li",{className:"flex items-center gap-3",children:[(0,l.jsx)("span",{className:"bg-blue-500/20 text-blue-400 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",children:"2"}),(0,l.jsx)("span",{children:"Allow camera permissions when prompted"})]}),(0,l.jsxs)("li",{className:"flex items-center gap-3",children:[(0,l.jsx)("span",{className:"bg-blue-500/20 text-blue-400 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",children:"3"}),(0,l.jsx)("span",{children:"Click connect in the device panel →"})]})]})]})]})}),(0,l.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-black/20 pointer-events-none"})]}),s&&(0,l.jsxs)("div",{className:"mt-8 flex items-center justify-between flex-wrap gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)("button",{className:"bg-slate-700/50 hover:bg-slate-600/60 border border-slate-600/50 text-white px-6 py-3 rounded-xl transition-all duration-200 flex items-center gap-3 font-medium",children:"\uD83D\uDCF7 Capture Frame"}),(0,l.jsx)("button",{className:"bg-red-600/20 hover:bg-red-600/30 border border-red-500/40 text-red-400 px-6 py-3 rounded-xl transition-all duration-200 flex items-center gap-3 font-medium",children:"\uD83C\uDFA5 Record Stream"}),(0,l.jsxs)("select",{value:f,onChange:e=>j(e.target.value),className:"bg-slate-700/50 border border-slate-600/50 text-white px-4 py-3 rounded-xl text-sm",children:[(0,l.jsx)("option",{value:"HD",children:"HD Quality"}),(0,l.jsx)("option",{value:"SD",children:"SD Quality"}),(0,l.jsx)("option",{value:"LOW",children:"Low Quality"})]})]}),(0,l.jsx)("button",{onClick:()=>{S.current&&(document.fullscreenElement?document.exitFullscreen():S.current.requestFullscreen())},className:"bg-slate-700/50 hover:bg-slate-600/60 border border-slate-600/50 text-white px-6 py-3 rounded-xl transition-all duration-200 flex items-center gap-2 font-medium",children:"⛶ Fullscreen"})]})]})}),(0,l.jsxs)("div",{className:"xl:col-span-1 space-y-6",children:[(0,l.jsxs)("div",{className:"bg-slate-800/40 backdrop-blur-sm border border-slate-700/50 rounded-2xl p-6",children:[(0,l.jsxs)("h3",{className:"text-xl font-bold text-white mb-6 flex items-center gap-3",children:["\uD83D\uDCF1 Devices",(0,l.jsx)("span",{className:"bg-blue-500/20 text-blue-400 text-sm px-3 py-1 rounded-full",children:e.length})]}),(0,l.jsx)("div",{className:"space-y-4",children:0===e.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"text-6xl mb-4 opacity-20",children:"\uD83D\uDCF1"}),(0,l.jsx)("p",{className:"text-slate-400 text-sm mb-2 font-medium",children:"No phones detected"}),(0,l.jsx)("p",{className:"text-slate-500 text-xs leading-relaxed",children:"Make sure your phone is on the same network and has opened the camera page"})]}):e.map(e=>(0,l.jsxs)("div",{className:"bg-slate-700/30 border border-slate-600/50 rounded-xl p-5 transition-all duration-300 hover:bg-slate-700/50 hover:border-slate-500/70",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("span",{className:"text-slate-200 font-semibold mb-1",children:"\uD83D\uDCF1 Phone Device"}),(0,l.jsxs)("span",{className:"font-mono text-sm text-blue-400 bg-slate-800/70 px-3 py-1.5 rounded-lg",children:["ID: ",e.slice(-8)]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-end",children:[(0,l.jsx)("div",{className:"w-4 h-4 rounded-full mb-2 ".concat(s===e?"bg-green-400 shadow-lg shadow-green-400/50 animate-pulse":"bg-yellow-400 animate-pulse")}),(0,l.jsx)("span",{className:"text-xs text-slate-400",children:s===e?"Connected":"Available"})]})]}),(0,l.jsx)("button",{onClick:()=>O(e),disabled:o||s===e,className:"w-full py-4 px-4 rounded-lg text-sm font-semibold transition-all duration-300 ".concat(s===e?"bg-green-600/20 border border-green-500/50 text-green-400 cursor-not-allowed":o?"bg-slate-600/20 border border-slate-500/50 text-slate-400 cursor-not-allowed":"bg-blue-600/20 border border-blue-500/50 text-blue-400 hover:bg-blue-600/30 hover:border-blue-400/70"),children:s===e?"✅ Connected - Receiving Stream":o?"⏳ Connecting...":"\uD83D\uDD17 Connect to Camera"})]},e))}),s&&(0,l.jsx)("button",{onClick:A,className:"w-full mt-6 bg-red-600/20 border border-red-500/50 text-red-400 hover:bg-red-600/30 hover:border-red-400/70 font-semibold py-3 px-4 rounded-xl transition-all duration-300",children:"\uD83D\uDD0C Disconnect"})]}),(0,l.jsxs)("div",{className:"bg-gradient-to-br from-green-900/20 to-blue-900/20 border border-green-700/30 rounded-2xl p-6",children:[(0,l.jsx)("h4",{className:"text-lg font-bold text-green-300 mb-4 flex items-center gap-2",children:"� Performance Metrics"}),s?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("button",{onClick:K,disabled:v,className:"w-full py-3 px-4 rounded-lg text-sm font-medium transition-all duration-200 ".concat(v?"bg-yellow-600/20 border border-yellow-500/30 text-yellow-400 cursor-not-allowed":"bg-green-600/20 hover:bg-green-600/30 border border-green-500/30 text-green-400"),children:v?"\uD83D\uDD04 Running Benchmark...":"\uD83D\uDE80 Run 30s Benchmark"}),v&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex justify-between text-xs text-slate-400",children:[(0,l.jsx)("span",{children:"Progress"}),(0,l.jsxs)("span",{children:[Math.round(D),"%"]})]}),(0,l.jsx)("div",{className:"w-full bg-slate-700/50 rounded-full h-2",children:(0,l.jsx)("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-200",style:{width:"".concat(D,"%")}})}),(0,l.jsxs)("div",{className:"text-center text-xs text-slate-500",children:[Math.round(D/100*30),"s / 30s"]})]}),y&&(0,l.jsxs)("div",{className:"bg-slate-800/40 rounded-lg p-4 space-y-3",children:[(0,l.jsxs)("div",{className:"text-center text-sm font-medium text-green-400 mb-3",children:["✅ Benchmark Complete (",y.testDuration,"s)"]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[(0,l.jsxs)("div",{className:"bg-slate-700/30 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-slate-400 mb-1",children:"Median Latency"}),(0,l.jsxs)("div",{className:"text-white font-bold",children:[y.medianLatency,"ms"]})]}),(0,l.jsxs)("div",{className:"bg-slate-700/30 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-slate-400 mb-1",children:"P95 Latency"}),(0,l.jsxs)("div",{className:"text-white font-bold",children:[y.p95Latency,"ms"]})]}),(0,l.jsxs)("div",{className:"bg-slate-700/30 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-slate-400 mb-1",children:"Processed FPS"}),(0,l.jsx)("div",{className:"text-white font-bold",children:y.processedFPS})]}),(0,l.jsxs)("div",{className:"bg-slate-700/30 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-slate-400 mb-1",children:"Downlink"}),(0,l.jsxs)("div",{className:"text-white font-bold",children:[y.downlinkKbps," Kbps"]})]}),(0,l.jsxs)("div",{className:"col-span-2 bg-slate-700/30 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-slate-400 mb-1",children:"Uplink"}),(0,l.jsxs)("div",{className:"text-white font-bold text-center",children:[y.uplinkKbps," Kbps"]})]})]}),(0,l.jsx)("button",{onClick:()=>w(null),className:"w-full mt-3 bg-slate-600/20 hover:bg-slate-600/30 border border-slate-500/30 text-slate-400 py-2 px-3 rounded-lg text-xs transition-all duration-200",children:"Clear Results"})]}),(0,l.jsxs)("div",{className:"bg-slate-800/30 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-xs font-medium text-slate-300 mb-2",children:"Live Stats"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-slate-400",children:"Current FPS:"}),(0,l.jsx)("span",{className:"text-white font-mono ml-2",children:p})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-slate-400",children:"Detections:"}),(0,l.jsx)("span",{className:"text-white font-mono ml-2",children:h})]})]})]})]}):(0,l.jsxs)("div",{className:"text-center py-8",children:[(0,l.jsx)("div",{className:"text-4xl mb-3 opacity-30",children:"\uD83D\uDCCA"}),(0,l.jsx)("p",{className:"text-slate-400 text-sm",children:"Connect a device to run benchmarks"})]})]})]})]})]})]}):(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-950 flex items-center justify-center",children:(0,l.jsx)("div",{className:"text-white text-2xl font-light",children:"Loading WebRTC Viewer..."})})}}},e=>{e.O(0,[441,964,358],()=>e(e.s=1985)),_N_E=e.O()}]);